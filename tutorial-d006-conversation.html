<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Tutorial: 会话 | Gtedx IM SDK</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-jsdoc.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/tui-doc.css">

    
</head>
<body>
<nav class="lnb" id="lnb">
    <div class="logo" style="">
        
            <img src="img/toast-ui.png" width="100%" height="100%">
        
    </div>
    <div class="title">
        <h1><a href="index.html" class="link">Gtedx IM SDK</a></h1>
        
            <span class="version">v1.0.0</span>
        
    </div>
    <div class="search-container" id="search-container">
        <input type="text" placeholder="Search">
        <ul></ul>
    </div>
    
        <ol class="lnb-tab">
            <li id="api-tab">
                <a href="#"><h4>API</h4></a>
            </li>
            <li id="examples-tab">
                <a href="#"><h4>Examples</h4></a>
            </li>
        </ol>
    
    <div class="lnb-examples hidden"><h3>Examples</h3><ul><li><a href="tutorial-d001-introduction.html">简介</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="d001-introduction_sub"></div></li><li><a href="tutorial-d002-install-init.html">安装和初始化</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="d002-install-init_sub"></div></li><li><a href="tutorial-d003-single-chat.html">单聊</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="d003-single-chat_sub"></div></li><li><a href="tutorial-d004-group-chat.html">群聊</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="d004-group-chat_sub"></div></li><li><a href="tutorial-d005-message.html">消息</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="d005-message_sub"></div></li><li><a href="tutorial-d006-conversation.html">会话</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="d006-conversation_sub"></div></li><li><a href="tutorial-d007-cache.html">缓存</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="d007-cache_sub"></div></li><li><a href="tutorial-d008-client-event.html">事件</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="d008-client-event_sub"></div></li><li><a href="tutorial-d009-signin.html">登录</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="d009-signin_sub"></div></li><li><a href="tutorial-d010-signout.html">登出</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="d010-signout_sub"></div></li><li><a href="tutorial-d011-reconnect.html">断线重连</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="d011-reconnect_sub"></div></li><li><a href="tutorial-d012-multi-media-message.html">富媒体消息</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="d012-multi-media-message_sub"></div></li><li><a href="tutorial-d021-note.html">注意事项</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="d021-note_sub"></div></li><li><a href="tutorial-d022-update.html">方法更新</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="d022-update_sub"></div></li><li><a href="tutorial-d031-file-upload.html">文件上传</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="d031-file-upload_sub"></div></li></ul></div><div class="lnb-api hidden"><h3>Modules</h3><ul><li><a href="module-Overview.html">Overview</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:Overview_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="module-Overview.html#.Cache">Cache</a></li><li><a href="module-Overview.html#.Cb">Cb</a></li><li><a href="module-Overview.html#.Conversation">Conversation</a></li><li><a href="module-Overview.html#.ConversationField">ConversationField</a></li><li><a href="module-Overview.html#.ConversationType">ConversationType</a></li><li><a href="module-Overview.html#.Env">Env</a></li><li><a href="module-Overview.html#.Event">Event</a></li><li><a href="module-Overview.html#.ImageMessage">ImageMessage</a></li><li><a href="module-Overview.html#.ImConfig">ImConfig</a></li><li><a href="module-Overview.html#.ImFile">ImFile</a></li><li><a href="module-Overview.html#.ImService">ImService</a></li><li><a href="module-Overview.html#.Log">Log</a></li><li><a href="module-Overview.html#.Message">Message</a></li><li><a href="module-Overview.html#.MessageField">MessageField</a></li><li><a href="module-Overview.html#.MessageType">MessageType</a></li><li><a href="module-Overview.html#.Platform">Platform</a></li><li><a href="module-Overview.html#.TextMessage">TextMessage</a></li><li><a href="module-Overview.html#.TypedMessage">TypedMessage</a></li></ul></div></li></ul></div><div class="lnb-api hidden"><h3>Classes</h3><ul><li><a href="Cache.html">Cache</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Cache_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="Cache.html#cacheConversation">cacheConversation</a></li><li><a href="Cache.html#cacheConversations">cacheConversations</a></li><li><a href="Cache.html#cacheMessage">cacheMessage</a></li><li><a href="Cache.html#cacheMessages">cacheMessages</a></li><li><a href="Cache.html#clearConversationMessages">clearConversationMessages</a></li><li><a href="Cache.html#clearMessages">clearMessages</a></li><li><a href="Cache.html#clearOverdueMessages">clearOverdueMessages</a></li><li><a href="Cache.html#deleteConversation">deleteConversation</a></li><li><a href="Cache.html#getConversation">getConversation</a></li><li><a href="Cache.html#getConversations">getConversations</a></li><li><a href="Cache.html#getLastMessageByCid">getLastMessageByCid</a></li><li><a href="Cache.html#getMessages">getMessages</a></li><li><a href="Cache.html#getUnreadMsgCount">getUnreadMsgCount</a></li><li><a href="Cache.html#readMessageByCid">readMessageByCid</a></li></ul></div></li><li><a href="Cb.html">Cb</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Cb_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Cb.html#.CodeNo">CodeNo</a></li><li><a href="Cb.html#.CodeOk">CodeOk</a></li><li><a href="Cb.html#.No">No</a></li><li><a href="Cb.html#.Ok">Ok</a></li><li><a href="Cb.html#code">code</a></li><li><a href="Cb.html#data">data</a></li><li><a href="Cb.html#message">message</a></li></ul></div></li><li><a href="Conversation.html">Conversation</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Conversation_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="Conversation.html#add">add</a></li><li><a href="Conversation.html#clearMessages">clearMessages</a></li><li><a href="Conversation.html#count">count</a></li><li><a href="Conversation.html#getLastMessage">getLastMessage</a></li><li><a href="Conversation.html#getMessages">getMessages</a></li><li><a href="Conversation.html#join">join</a></li><li><a href="Conversation.html#quit">quit</a></li><li><a href="Conversation.html#read">read</a></li><li><a href="Conversation.html#remove">remove</a></li><li><a href="Conversation.html#save">save</a></li><li><a href="Conversation.html#send">send</a></li></ul></div></li><li><a href="ConversationField.html">ConversationField</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="ConversationField_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="ConversationField.html#.Attrs">Attrs</a></li><li><a href="ConversationField.html#.ConversationId">ConversationId</a></li><li><a href="ConversationField.html#.Icon">Icon</a></li><li><a href="ConversationField.html#.ManagerId">ManagerId</a></li><li><a href="ConversationField.html#.MemberIds">MemberIds</a></li><li><a href="ConversationField.html#.Remark">Remark</a></li><li><a href="ConversationField.html#.Title">Title</a></li><li><a href="ConversationField.html#.Type">Type</a></li><li><a href="ConversationField.html#.UnreadCount">UnreadCount</a></li></ul></div></li><li><a href="ConversationType.html">ConversationType</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="ConversationType_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="ConversationType.html#.Group">Group</a></li><li><a href="ConversationType.html#.Single">Single</a></li></ul></div></li><li><a href="Env.html">Env</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Env_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Env.html#.Dev">Dev</a></li><li><a href="Env.html#.Prd">Prd</a></li><li><a href="Env.html#.Test">Test</a></li></ul></div></li><li><a href="FileMessage.html">FileMessage</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="FileMessage_sub"></div></li><li><a href="ImageMessage.html">ImageMessage</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="ImageMessage_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="ImageMessage.html#getRatioUri">getRatioUri</a></li></ul></div></li><li><a href="ImClient.html">ImClient</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="ImClient_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="ImClient.html#currentConversationList">currentConversationList</a></li><li><a href="ImClient.html#currentConversationList">currentConversationList</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="ImClient.html#clearMessages">clearMessages</a></li><li><a href="ImClient.html#clearOverdueMessages">clearOverdueMessages</a></li><li><a href="ImClient.html#close">close</a></li><li><a href="ImClient.html#createConversation">createConversation</a></li><li><a href="ImClient.html#createFile">createFile</a></li><li><a href="ImClient.html#disbandConversation">disbandConversation</a></li><li><a href="ImClient.html#getConversation">getConversation</a></li><li><a href="ImClient.html#getConversations">getConversations</a></li><li><a href="ImClient.html#getUnreadMsgCount">getUnreadMsgCount</a></li><li><a href="ImClient.html#pause">pause</a></li><li><a href="ImClient.html#refreshConversations">refreshConversations</a></li><li><a href="ImClient.html#reopen">reopen</a></li><li><a href="ImClient.html#resume">resume</a></li><li><a href="ImClient.html#setCache">setCache</a></li></ul></div></li><li><a href="ImConfig.html">ImConfig</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="ImConfig_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="ImConfig.html#client_id">client_id</a></li><li><a href="ImConfig.html#env">env</a></li><li><a href="ImConfig.html#platform">platform</a></li><li><a href="ImConfig.html#uid">uid</a></li></ul></div></li><li><a href="ImEvent.html">ImEvent</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="ImEvent_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="ImEvent.html#ConversationClearMessages">ConversationClearMessages</a></li><li><a href="ImEvent.html#Conversations">Conversations</a></li><li><a href="ImEvent.html#End">End</a></li><li><a href="ImEvent.html#Error">Error</a></li><li><a href="ImEvent.html#ManualGetLastMessage">ManualGetLastMessage</a></li><li><a href="ImEvent.html#Message">Message</a></li><li><a href="ImEvent.html#UnreadMessagesCountUpdate">UnreadMessagesCountUpdate</a></li></ul></div></li><li><a href="ImFile.html">ImFile</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="ImFile_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="ImFile.html#file">file</a></li><li><a href="ImFile.html#uri">uri</a></li></ul></div></li><li><a href="ImService.html">ImService</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="ImService_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="ImService.html#options">options</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="ImService.html#createImClient">createImClient</a></li><li><a href="ImService.html#pause">pause</a></li><li><a href="ImService.html#resume">resume</a></li></ul></div></li><li><a href="ImType.html">ImType</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="ImType_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="ImType.html#.ErrorMsg">ErrorMsg</a></li><li><a href="ImType.html#.OffLine">OffLine</a></li><li><a href="ImType.html#.OnLine">OnLine</a></li><li><a href="ImType.html#.Received">Received</a></li><li><a href="ImType.html#.UserOnline">UserOnline</a></li></ul></div></li><li><a href="Message.html">Message</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Message_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="Message.html#getMentionList">getMentionList</a></li><li><a href="Message.html#mentionAll">mentionAll</a></li><li><a href="Message.html#setMentionList">setMentionList</a></li></ul></div></li><li><a href="MessageFactory.html">MessageFactory</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="MessageFactory_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="MessageFactory.html#.createMessage">createMessage</a></li></ul></div></li><li><a href="MessageField.html">MessageField</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="MessageField_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="MessageField.html#.Attrs">Attrs</a></li><li><a href="MessageField.html#.ConversationID">ConversationID</a></li><li><a href="MessageField.html#.File">File</a></li><li><a href="MessageField.html#.Io">Io</a></li><li><a href="MessageField.html#.IsRead">IsRead</a></li><li><a href="MessageField.html#.MentionedAll">MentionedAll</a></li><li><a href="MessageField.html#.MentionedMe">MentionedMe</a></li><li><a href="MessageField.html#.MentionList">MentionList</a></li><li><a href="MessageField.html#.Message">Message</a></li><li><a href="MessageField.html#.MessageID">MessageID</a></li><li><a href="MessageField.html#.MessageType">MessageType</a></li><li><a href="MessageField.html#.SendBy">SendBy</a></li><li><a href="MessageField.html#.SendTime">SendTime</a></li><li><a href="MessageField.html#.Uri">Uri</a></li></ul></div></li><li><a href="MessageType.html">MessageType</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="MessageType_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="MessageType.html#.Image">Image</a></li><li><a href="MessageType.html#.Text">Text</a></li></ul></div></li><li><a href="Platform.html">Platform</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="Platform_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="Platform.html#.App">App</a></li><li><a href="Platform.html#.Web">Web</a></li></ul></div></li><li><a href="ReconnectingWebSocket.html">ReconnectingWebSocket</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="ReconnectingWebSocket_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="ReconnectingWebSocket.html#.debugAll">debugAll</a></li><li><a href="ReconnectingWebSocket.html#automaticOpen">automaticOpen</a></li><li><a href="ReconnectingWebSocket.html#binaryType">binaryType</a></li><li><a href="ReconnectingWebSocket.html#close">close</a></li><li><a href="ReconnectingWebSocket.html#debug">debug</a></li><li><a href="ReconnectingWebSocket.html#maxReconnectAttempts">maxReconnectAttempts</a></li><li><a href="ReconnectingWebSocket.html#maxReconnectInterval">maxReconnectInterval</a></li><li><a href="ReconnectingWebSocket.html#protocol">protocol</a></li><li><a href="ReconnectingWebSocket.html#readyState">readyState</a></li><li><a href="ReconnectingWebSocket.html#reconnectAttempts">reconnectAttempts</a></li><li><a href="ReconnectingWebSocket.html#reconnectDecay">reconnectDecay</a></li><li><a href="ReconnectingWebSocket.html#reconnectInterval">reconnectInterval</a></li><li><a href="ReconnectingWebSocket.html#refresh">refresh</a></li><li><a href="ReconnectingWebSocket.html#send">send</a></li><li><a href="ReconnectingWebSocket.html#timeoutInterval">timeoutInterval</a></li><li><a href="ReconnectingWebSocket.html#url">url</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="ReconnectingWebSocket.html#onclose">onclose</a></li><li><a href="ReconnectingWebSocket.html#onconnecting">onconnecting</a></li><li><a href="ReconnectingWebSocket.html#onerror">onerror</a></li><li><a href="ReconnectingWebSocket.html#onmessage">onmessage</a></li><li><a href="ReconnectingWebSocket.html#onopen">onopen</a></li></ul></div></li><li><a href="TextMessage.html">TextMessage</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="TextMessage_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="TextMessage.html#attributes">attributes</a></li><li><a href="TextMessage.html#text">text</a></li><li><a href="TextMessage.html#type">type</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="TextMessage.html#getAttributes">getAttributes</a></li><li><a href="TextMessage.html#getMentionList">getMentionList</a></li><li><a href="TextMessage.html#getText">getText</a></li><li><a href="TextMessage.html#mentionAll">mentionAll</a></li><li><a href="TextMessage.html#setAttributes">setAttributes</a></li><li><a href="TextMessage.html#setMentionList">setMentionList</a></li><li><a href="TextMessage.html#setText">setText</a></li></ul></div></li><li><a href="TypedMessage.html">TypedMessage</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="TypedMessage_sub"><div class="member-type">Members</div><ul class="inner"><li><a href="TypedMessage.html#attributes">attributes</a></li><li><a href="TypedMessage.html#text">text</a></li><li><a href="TypedMessage.html#type">type</a></li></ul><div class="member-type">Methods</div><ul class="inner"><li><a href="TypedMessage.html#getAttributes">getAttributes</a></li><li><a href="TypedMessage.html#getMentionList">getMentionList</a></li><li><a href="TypedMessage.html#getText">getText</a></li><li><a href="TypedMessage.html#mentionAll">mentionAll</a></li><li><a href="TypedMessage.html#setAttributes">setAttributes</a></li><li><a href="TypedMessage.html#setMentionList">setMentionList</a></li><li><a href="TypedMessage.html#setText">setText</a></li></ul></div></li></ul></div>
</nav>
<div id="resizer"></div>

<div class="main" id="main">
    

<section>
    <header>
        

        <h2>会话</h2>
    </header>

    
        <article class="readme">
            <p>我们将单聊和群聊（包括聊天室）的消息发送和接收都依托于 <a href="Conversation.html">Conversation</a> 这个统一的概念进行操作，所以开发者需要强化理解的一个概念就是：<strong>SDK 层面不区分单聊和群聊</strong>。</p>
<p>对话的管理包括<strong>「成员管理」</strong>和<strong>「属性管理」</strong>两个方面。</p>
<p>在讲解下面的内容之前，我们先使用 Jerry 的身份登录并创建一个多人对话。后面的举例中 <code>jerry</code> 指 Jerry 登录的 client，conversation 指创建好的这个对话，CONVERSATION_ID 指这个对话的 ID。</p>
<pre class="prettyprint source lang-javascript"><code>import {ConversationField} from '@npm/im';

let imClient = imservice.createImClient('Jerry')
imClient.createConversation({
    user_ids: ['Bob', 'Harry', 'William'],
  });
}).then(function(conversation) {
  var CONVERSATION_ID = conversation[ConversationField.ConversationId];
  // now we have jerry, conversation and CONVERSATION_ID
})</code></pre><h2>创建会话</h2><pre class="prettyprint source lang-javascript"><code>jerry.createConversation({
  user_ids: ['Bob', 'Harry', 'William'],
  title: '周末滑雪'
  unique: false,
});</code></pre><p>参数说明：</p>
<ul>
<li>user_ids - 会话的初始成员列表。在会话创建成功后，这些成员会收到和邀请加入会话一样的相应通知。</li>
<li>title - 对话的名字，主要是用于标记对话，让用户更好地识别会话。</li>
<li>unique - 是否创建唯一对话，当其为 true 时，如果当前已经有<strong>相同成员</strong>的对话存在则返回该对话，否则会创建新的对话。该值默认为 false。</li>
</ul>
<h2>会话的成员管理</h2><p>成员管理，是在对话中对成员的一个实时生效的操作，一旦操作成功则不可逆。</p>
<h4>成员变更接口</h4><p>成员变更操作接口简介如下表：</p>
<table>
<thead>
<tr>
<th>操作目的</th>
<th>接口名</th>
</tr>
</thead>
<tbody>
<tr>
<td>自身主动加入</td>
<td><code>Conversation#join</code></td>
</tr>
<tr>
<td>添加其他成员</td>
<td><code>Conversation#add</code></td>
</tr>
<tr>
<td>自身主动退出</td>
<td><code>Conversation#quit</code></td>
</tr>
<tr>
<td>移除其他成员</td>
<td><code>Conversation#remove</code></td>
</tr>
</tbody>
</table>
<h4>成员变更事件 【待实现】</h4><h4>添加成员</h4><h5>自身主动加入【待实现】</h5><p>Tom 想主动加入 Jerry、Bob、Harry 和 William 的对话，以下代码将帮助他实现这个功能：</p>
<pre class="prettyprint source lang-javascript"><code>let imClient = imService.createImClient('Tom');

imClient.getConversation(CONVERSATION_ID)
.then(function(conversation) {
  return conversation.join();

}).then(function(conversation) {
  console.log('加入成功', conversation[ConversationField.MemberIds]);
  // 加入成功 ['Bob', 'Harry', 'William', 'Tom']

}).catch(console.error.bind(console));</code></pre><h5>添加其他成员</h5><p>Jerry 想再把 Mary 加入到对话中，需要如下代码帮助他实现这个功能：</p>
<pre class="prettyprint source lang-javascript"><code>conversation.add(['Mary'])
.then(function(conversation) {
  console.log('添加成功', conversation[ConversationField.MemberIds]);
  // 添加成功 ['Bob', 'Harry', 'William', 'Tom', 'Mary']

}).catch(console.error.bind(console));</code></pre><h5>添加成员相关事件【待实现】</h5><p>TODO</p>
<h4>移除成员</h4><h5>自身退出对话【待实现】</h5><p>Tom 主动从对话中退出，他需要如下代码实现需求：</p>
<pre class="prettyprint source lang-javascript"><code>conversation.quit()
.then(function(conversation) {
  console.log('退出成功', conversation[ConversationField.MemberIds]);
  // 退出成功 ['Bob', 'Harry', 'William', 'Mary']
}).catch(console.error.bind(console));</code></pre><h5>移除其他成员</h5><p>Harry 被 William 从对话中删除。实现代码如下：</p>
<pre class="prettyprint source lang-javascript"><code>let imClient = imService.createImClient('William');

imClient.getConversation(CONVERSATION_ID)
.then(function(conversation) {
  return conversation.remove(['Harry']);
}).then(function(conversation) {
  console.log('移除成功', conversation[ConversationField.MemberIds]);
  // 移除成功 ['Bob', 'William', 'Mary']
}).catch(console.error.bind(console));</code></pre><h5>移除成员相关事件【待实现】</h5><h4>查询成员数量</h4><p>除了直接访问 <code>conversation[ConversationField.MemberIds].length</code>，也可以通过 <code><a href="Conversation.html#count">Conversation#count</a></code> 方法获得当前对话的成员数量：</p>
<pre class="prettyprint source lang-javascript"><code>let membersCount = conversation.count();</code></pre><h2>会话的属性管理</h2><p><a href="Conversation.html">Conversation</a>其字段含义如下：</p>
<table>
<thead>
<tr>
<th style="text-align:left">name</th>
<th style="text-align:left">type</th>
<th style="text-align:left">description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">id</td>
<td style="text-align:left">string</td>
<td style="text-align:left">会话对象主键</td>
</tr>
<tr>
<td style="text-align:left">title</td>
<td style="text-align:left">string</td>
<td style="text-align:left">会话标题</td>
</tr>
<tr>
<td style="text-align:left">icon</td>
<td style="text-align:left">string</td>
<td style="text-align:left">会话图标</td>
</tr>
<tr>
<td style="text-align:left">manager_id</td>
<td style="text-align:left">string</td>
<td style="text-align:left">会话管理员</td>
</tr>
<tr>
<td style="text-align:left">remark</td>
<td style="text-align:left">string</td>
<td style="text-align:left">会话备注</td>
</tr>
<tr>
<td style="text-align:left">user_count</td>
<td style="text-align:left">numeric</td>
<td style="text-align:left">会话成员数量</td>
</tr>
<tr>
<td style="text-align:left">attrs</td>
<td style="text-align:left">string</td>
<td style="text-align:left">前台附加参数</td>
</tr>
<tr>
<td style="text-align:left">create_time</td>
<td style="text-align:left">string</td>
<td style="text-align:left">会话创建时间</td>
</tr>
<tr>
<td style="text-align:left">type</td>
<td style="text-align:left">string</td>
<td style="text-align:left">会话类型:SINGLE_CHAT or GROUP_CHAT</td>
</tr>
<tr>
<td style="text-align:left">user_ids</td>
<td style="text-align:left">list</td>
<td style="text-align:left">会话成员id列表</td>
</tr>
</tbody>
</table>
<h4>名称</h4><p>这是一个全员共享的属性，它可以在创建时指定，也可以在日后的维护中被修改。</p>
<p>Tom 想建立一个名字叫「喵星人」 对话并且邀请了好友 Black 加入对话：</p>
<pre class="prettyprint source lang-javascript"><code>tom.createConversation({
  user_ids: ['Black'],
  title: '喵星人',
}).then(function(conversation) {
  console.log('创建成功id: ' + conversation[ConversationField.ConversationId] + ' title: ' + conversation[ConversationField.Title]);
}).catch(console.error.bind(console));</code></pre><p>Black 发现对话名字不够酷，他想修改成「聪明的喵星人」 ，他需要如下代码：</p>
<pre class="prettyprint source lang-javascript"><code>black.getConversation(CONVERSATION_ID)
.then(function(conversation) {
  conversation[ConversationField.Title] = '聪明的喵星人';
  return conversation.save();
}).then(function(conversation) {
  console.log('更新成功title: ' + conversation[ConversationField.Title]);
}).catch(console.error.bind(console));</code></pre><h2>会话的查询</h2><blockquote>
<p>会话的查询分为两部分：<strong>被动接收会话</strong>和<strong>主动查询会话</strong></p>
<p><strong>主动查询会话</strong>部分</p>
</blockquote>
<h3>被动接收会话</h3><pre class="prettyprint source lang-javascript"><code>    componentDidMount() {
        this.imService = new ImService(GLOBAL.Options);
        this.imClient = this.imService.createIMClient(GLOBAL.User.uid);
        this.imClient.setCache(new CacheApp()); // 实例化ImClient之后必须先设置缓存
        this.imClient.getConversations(); // 在程序初始化的时候，必须手动调用一次

        this.imClient.on(ET.Conversations, this._onConversation);// 必须注册此事件，才能接收到会话列表数据
        this.imClient.on(ET.Message, this._onMessage);
        this.imClient.on(ET.Error, this._onError);

        GLOBAL.ImClient = this.imClient;
    }


    _onConversation = (conversations) => {
        this.setState({data: conversations});
    }

    _onMessage = (message) => {
        GLOBAL.Toast(&quot;message = &quot; + JSON.stringify(message));
    }

    _onError = (error) => {
        GLOBAL.Toast(&quot;error = &quot; + error.toString());
    }</code></pre><blockquote>
<p>说明：</p>
<p>imClient.getConversations(); </p>
<p>imClient.on(ET.Conversations, this._onConversation);</p>
<p>在程序初始化的时候，必须手动调用一次，在之后的与IM SDK交互的过程中无需再次调用。</p>
<p>只要在imClient实例上注册了<a href="ImEvent.html">ImEvent</a>.CONVERSATIONS事件，</p>
<p>当有新的会话创建或者新的消息被接收|被发送，IM SDK会自动更新会话列表。</p>
</blockquote>
<h3>主动查询会话【待实现】</h3><h4>根据 id 查询【已实现】</h4><p>假如已知某一对话的 Id，可以使用它来查询该对话的详细信息：</p>
<pre class="prettyprint source lang-javascript"><code>tom.getConversation(CONVERSATION_ID)
.then(function(conversation) {
  console.log(conversation[ConversationField.ConversationId]);
}).catch(console.error.bind(console));</code></pre><h4>会话列表</h4><h4>条件查询</h4><p>条件查询又分为：比较查询、正则匹配查询、包含查询，组合查询，空值查询，以下会做分类演示。</p>
<h5>比较查询</h5><h5>正则匹配查询</h5><h5>包含查询</h5><h4>查询结果选项</h4><h5>排序</h5><h5>精简模式</h5><h2>会话的最后一条消息</h2><p>开发者在获取到会话列表之后，会做UI的展示。而会话列表中的每一个<a href="Conversation.html">Conversation</a>实例，都对应这一个Item(UI 组件)，在其组件内部进行最后一条消息事件ImEvent.Message的注册，即可实时更新最后一条消息。</p>
<blockquote>
<p>注意：在初次实例化Item组件的时候，要手动调用一次 <a href="Conversation.html#getLastMessage">Conversation#getLastMessage</a> 方法获取最后一条消息，随后即可通过监听去实时更新。</p>
</blockquote>
<pre class="prettyprint source lang-javascript"><code>// 注册监听【注意：此处目前在render()方法中注册有效，SDK本身没有问题，应该是组件的问题】
conversation.on(ET.Message, this._onLastMessage);

// 手动调用一次
conversation.getLastMessage()
    .then(message => {
        this._onLastMessage(message);
    }).catch(error => {});

// 实时更新最后一条消息
_onLastMessage = (message) => {
    this.setState({
       datetime: moment(message[MessageField.SendTime], &quot;YYYY-MM-DD HH:mm:ss&quot;).fromNow(),
       message: message[MessageField.Message]
    })
}</code></pre>
        </article>
    
</section>



</div>

<footer>
    <img class="logo" src="img/toast-ui.png" style="">
    <div class="footer-text">Copyright © 2018 Gtedx Pte Ltd</div>
</footer>
<script>prettyPrint();</script>
<script src="scripts/jquery.min.js"></script>
<script src="scripts/tui-doc.js"></script>
<script src="scripts/linenumber.js"></script>

    <script>
        showLnbExamples();
    </script>

</body>
</html>